#############################################################
## JOB DESCRIPTION                                         ##
#############################################################

# This is what this job does



#############################################################
## Specify Amber format
#############################################################

# INPUT 
set temperature    300
# CLUSTSER
#parameters         /gpfs/huskeypm/PARMS/par_all27_prot_lipidNBFIX.prm
# HOME 
# parameters         /net/home/huskeypm/PARMS/par_all27_prot_lipidNBFIX.prm
# RANGER 
#parameters         /scratch/00623/tg457915/pete/PARMS/par_all27_prot_lipidNBFIX.prm
# DAVINCI
parameters          /home/AD/pmke226/PARMS/par_all27_prot_lipidNBFIX.prm      
paraTypeCharmm          on


# TOPOLOGY 
#set mutname  ../02-MEMBRANE/1su4-popcwi
set base /home/huskeypm/Work/vince_plb_r2
set base .

set mutname  $base/plb_popcwi
set inputname      $base/production30
structure $mutname.psf

# INITIAL CONDITIONS
#set inputname  ../eq/equil2
coordinates        $mutname.pdb

 # OUTPUTS
set outputname         production31

# Continuing a job
if {1} {

# checks to see if the .coor file exists (if the sim finished)
# if not, sim continues from the restart files
if [file exists $inputname.coor] {
bincoordinates     $inputname.coor
binvelocities      $inputname.vel  ;# remove the "temperature" entry if you use this!  
extendedSystem	   $inputname.xsc
} else {
bincoordinates     $inputname.restart.coor
#binvelocities      $inputname.restart.vel  ;# remove the "temperature" entry if you use this!
extendedSystem	   $inputname.restart.xsc
}
}

# procedure to get the first time step for the new simulation
# from the old simulation whether it be a completed sim or one
# to be restarted
if {1} { 
proc get_first_ts { xscfile } {
  set fd [open $xscfile r]
  gets $fd
  gets $fd
  gets $fd line
  set ts [lindex $line 0]
  close $fd
  return $ts
}

if [file exists $inputname.xsc] {
set firsttime [get_first_ts $inputname.xsc]
firsttimestep $firsttime
} else {
set firsttime [get_first_ts $inputname.restart.xsc]
firsttimestep $firsttime
}

} else {
firsttimestep      0
}



#############################################################
## SIMULATION PARAMETERS                                   ##
#############################################################

#temperature         $temperature
 

# Periodic Boundary conditions
# NOTE: Do not set the periodic cell basis if you have also 
# specified an .xsc restart file!
# use  ~/bin/Computato
#>78.89400148391724
#vmd > 76.07400369644165
#vmd > 75.11999893188477
#vmd > vmd > 34.39564514160156 35.513797760009766 31.98533058166504
 
if {0} { 
cellBasisVector1     75.249   0.    0.
cellBasisVector2     0.    76.2900  0.
cellBasisVector3     0.    0   76.2225 
cellOrigin           31.794462203979492 36.173301696777344 34.2393798828125
}
wrapWater           on
wrapAll             on


# Force-Field Parameters
exclude             scaled1-4
1-4scaling          1.000000
cutoff              12.
switching           on
switchdist          10.
pairlistdist        13.5
#scnb		    2.0	

# Integrator Parameters
timestep            2.0  ;# 2fs/step
rigidBonds          all  ;# needed for 2fs steps
nonbondedFreq       1
fullElectFrequency  2  
stepspercycle       20


#PME (for full-system periodic electrostatics)
if {1} {
PME                     yes
PMETolerance            10e-6
PMEInterpOrder          4
PMEGridSpacing          1.0 
#PMEGridSizeX       130
#PMEGridSizeY       140
#PMEGridSizeZ       160
}


# Constant Temperature Control
langevin            on    ;# do langevin dynamics
langevinDamping     1.0   ;# damping coefficient (gamma) of 1/ps
langevinTemp        $temperature
langevinHydrogen    off    ;# don't couple langevin bath to hydrogens

# Constant Pressure Control (variable volume)
if {0} {
useGroupPressure      yes ;# needed for 2fs steps
useFlexibleCell       no  ;# no for water box, yes for membrane
useConstantArea       no  ;# no for water box, yes for membrane

langevinPiston        on
langevinPistonTarget  1.01325 ;#  in bar -> 1 atm
langevinPistonPeriod  200. ;# 200 fs, double of what we often use (100)
langevinPistonDecay   100. ;# 100 fs, double of what we often use (50)
langevinPistonTemp    $temperature
}

# Output
outputName          $outputname
restartname         $outputname.restart
dcdfile             $outputname.dcd
xstFile             $outputname.xst

restartfreq         5000     ;# 500steps = every 1ps
dcdfreq             5000
xstFreq             5000
outputEnergies      1000
outputPressure      1000


# Fixed Atoms Constraint (set PDB beta-column to 1)
if {0} {
fixedAtoms          on
fixedAtomsFile      fixed2.pdb
fixedAtomsCol       B
}

# Constraint Atoms
if {0} {
constraints             on
consref                 mineq04-7077074-02.10ns.cons
conskfile               mineq04-7077074-02.10ns.cons
conskcol                O
 }

# SMD Settings
if {0} {
SMD             on
SMDFile         SMD.pdb
SMDk            7.2              #7.2kcal/molA 
SMDVel          0.0000015        #0.0015A/ps, or 1.5A/ns
SMDDir          0       0       -1
SMDOutputFreq   100
}


# IMD Settings (can view sim in VMD)
if {0} {
IMDon           on
IMDport         3000    ;# port number (enter it in VMD)
IMDfreq         1       ;# send every 1 frame
IMDwait         no      ;# wait for VMD to connect before running?
}



#############################################################
## AMD                                       ##
#############################################################
# AMD Setting REPLACE ME !!!!!!!s
#accelMD             on
#accelMDdihe         on
#accelMDE            14492
#accelMDalpha         8000
#accelMDOutFreq      1000

run               1250000

